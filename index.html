<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Apoteca Scala — Final</title>

<!-- GSAP -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js"></script>

<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=EB+Garamond:wght@500;600&family=Pretendard:wght@300;400;500;600&display=swap" rel="stylesheet" />

<style>
:root{
  --ivory:#F5F2E8; --dark:#2E2218; --gold:#C2A562; --amber:#A56B2C; --olive:#5C6A4B;
  --sec:100vh; --g:min(5vw,56px)
}
*{box-sizing:border-box}
html,body{height:100%}
body{margin:0;background:#000;color:var(--ivory);font-family:"Pretendard","Noto Sans KR",sans-serif;overflow-x:hidden}

/* Topbar */
.topbar{position:fixed;inset:0 0 auto 0;height:64px;z-index:90;display:flex;align-items:center;justify-content:space-between;
  padding:0 var(--g);background:linear-gradient(to bottom,rgba(245,242,232,.9),rgba(245,242,232,0));backdrop-filter:blur(6px);
  border-bottom:1px solid rgba(0,0,0,.06);transition:background .35s,border-color .35s}
.topbar.scrolled{background:rgba(245,242,232,.95);border-color:rgba(0,0,0,.1)}
.brand{font:600 20px/1 "EB Garamond",serif;letter-spacing:.06em;color:#2E2218}
.nav a{margin-left:28px;font-size:14px;color:#5c5146;text-decoration:none}
.nav a:hover{color:#2E2218}

/* Sections */
.section{position:relative;width:100vw;min-height:var(--sec);display:grid;grid-template-columns:1fr min(1200px,92vw) 1fr;align-items:center;overflow:hidden}
.content{grid-column:2;z-index:3;text-align:center;max-width:min(1200px,92vw);margin:auto}
h1,h2{font-family:"EB Garamond",serif;margin:0 0 10px}
h1{font-size:clamp(34px,6vw,68px)} h2{font-size:clamp(26px,4.8vw,48px)}
.lead{margin:0 auto 18px;max-width:68ch;color:rgba(255,255,255,.9)}
.bg{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;filter:brightness(.6) contrast(1.05);transform:scale(1.02);transition:transform 1.6s ease}
.section.visible .bg{transform:scale(1.06)}
/* 텍스트 가독성 보정 */
.section::after{content:"";position:absolute;inset:0;background:linear-gradient(180deg,rgba(0,0,0,.38),rgba(0,0,0,.12) 60%);z-index:1}
/* 라이트 모션 */
.light{position:absolute;inset:0;mix-blend-mode:screen;background:radial-gradient(40% 40% at 50% 50%,rgba(255,225,170,.22),transparent 65%);animation:glow 6s ease-in-out infinite alternate;z-index:2}
@keyframes glow{0%{opacity:.3;transform:scale(1)}100%{opacity:.7;transform:scale(1.2)}}
.swipe{content:"";position:absolute;top:0;left:-75%;width:50%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,.08),transparent);
  transform:skewX(-25deg);animation:lightMove 6s infinite;z-index:2}
@keyframes lightMove{0%{left:-75%}50%{left:125%}100%{left:125%}}

/* Special elements */
#particles{position:fixed;inset:0;pointer-events:none;z-index:0}

/* Hero */
#hero .stage{position:sticky;top:0;height:100vh}
#hero .img{position:absolute;inset:0;opacity:0;transform:scale(1.04)}

/* Herbarium loupe */
#herb .loupe{position:absolute;width:min(28vw,340px);height:min(28vw,340px);right:12vw;bottom:18vh;border-radius:50%;
  outline:1px solid rgba(0,0,0,.2);box-shadow:0 18px 40px rgba(0,0,0,.18) inset;background:radial-gradient(60% 60% at 50% 50%, rgba(255,255,255,.28), rgba(0,0,0,.12));
  mix-blend-mode:multiply;pointer-events:none;opacity:0}

/* Liquid ripples */
#liquid canvas{position:absolute;inset:0}

/* Door split */
#door .left,#door .right{position:absolute;top:0;bottom:0;width:50%;background:#120c07}
#door .left{left:0;transform-origin:left}#door .right{right:0;transform-origin:right}

/* Timeline */
.timeline{position:absolute;left:50%;transform:translateX(-50%);bottom:12vh;display:flex;gap:min(9vw,120px)}
.tp{color:#cbb;opacity:0;text-align:center}.dot{width:14px;height:14px;background:linear-gradient(180deg,#ead8a5,#c8a25a);border:1px solid rgba(0,0,0,.25);margin:0 auto 8px}

/* Products magnets */
.mag-row{position:absolute;left:50%;transform:translateX(-50%);bottom:8vh;display:flex;gap:min(5vw,40px);align-items:end}
.mag{width:min(12vw,160px);aspect-ratio:1/2;background:rgba(255,255,255,.05);outline:1px solid rgba(255,255,255,.08);mix-blend-mode:screen;transition:transform .2s,filter .2s}
.mag:hover{transform:translateY(-10px);filter:brightness(1.08)}

/* UGC grid */
.grid{position:absolute;inset:auto 0 10vh 0;display:grid;grid-template-columns:repeat(4,1fr);gap:18px;padding:0 var(--g)}
.cell{height:140px;background:rgba(255,255,255,.5);border:1px solid rgba(255,255,255,.2);opacity:0;transform:translateY(16px)}

/* Membership shine */
#member .shine{position:absolute;inset:0;mix-blend-mode:screen;opacity:0;background:
  radial-gradient(50% 50% at 30% 50%, rgba(255,235,180,.35), transparent 60%),
  radial-gradient(50% 50% at 70% 50%, rgba(255,215,140,.30), transparent 60%)}

/* Footer */
footer{min-height:60vh;display:grid;place-items:center}

/* Popup */
#popup{position:fixed;inset:0;display:none;align-items:center;justify-content:center;z-index:9999}
#popup.active{display:flex}
.pop-ov{position:absolute;inset:0;background:rgba(0,0,0,.45);backdrop-filter:blur(6px);animation:fade .4s forwards}
@keyframes fade{from{opacity:0}to{opacity:1}}
.pop{position:relative;background:var(--ivory);color:var(--dark);border:1px solid rgba(0,0,0,.1);box-shadow:0 20px 60px rgba(0,0,0,.25);
  padding:44px 52px;max-width:420px;text-align:center;animation:up .4s cubic-bezier(.25,.8,.25,1) forwards;transform:translateY(20px);opacity:0}
@keyframes up{to{transform:none;opacity:1}}
.pop h3{font:600 22px/1.3 "EB Garamond",serif;margin:0 0 12px}.pop p{color:#534a3f}
.pop input{width:100%;padding:12px;border:1px solid rgba(0,0,0,.25);margin:14px 0}
.pop .cta{background:linear-gradient(90deg,var(--gold),var(--amber));border:none;color:#fff;padding:12px 18px}
.pop .x{position:absolute;top:8px;right:12px;border:none;background:none;font-size:24px;color:#5a5146;cursor:pointer}

/* Reduced motion */
@media (prefers-reduced-motion: reduce){
  *{animation:none!important;transition:none!important}
  #particles,#herb .loupe,#liquid canvas{display:none}
}
</style>
</head>
<body>

<header class="topbar">
  <div class="brand">Apoteca Scala</div>
  <nav class="nav" aria-label="주요">
    <a href="#hero">Home</a><a href="#herb">Story</a><a href="#products">Products</a><a href="#member">Membership</a><a href="#gift">Gifting</a>
  </nav>
</header>

<canvas id="particles" aria-hidden="true"></canvas>

<!-- ===== 1) HERO (1~3 순차 크로스페이드) ===== -->
<section id="hero" class="section">
  <img class="bg img img-a" data-file="1.png" alt="">
  <img class="bg img img-b" data-file="2.png" alt="" style="opacity:0">
  <img class="bg img img-c" data-file="3.png" alt="" style="opacity:0">
  <div class="light"></div><div class="swipe"></div>
  <div class="content" style="z-index:4">
    <h1>오늘의 의식이 시작됩니다</h1>
    <p class="lead">허브 · 유리 · 빛. 조용히 집중되는 한 순간.</p>
  </div>
</section>

<!-- ===== 2) Herbarium — 2.png (섹션은 2번이지만 배경은 2.png가 히어로에도 쓰이므로 여기서는 4.png부터 시작) ===== -->
<section id="herb" class="section">
  <img class="bg" data-file="4.png" alt="">
  <div class="loupe"></div>
  <div class="content">
    <h2>라벤더의 고요, 세이지의 균형</h2>
    <p class="lead">오래된 도감처럼, 그러나 오늘에 맞게.</p>
  </div>
</section>

<!-- ===== 3) Corridor / Light weave — 4.png 효과 섹션은 위에서 처리, 다음은 5.png 문 ===== -->
<section id="door" class="section">
  <img class="bg" data-file="5.png" alt="">
  <div class="left"></div><div class="right"></div>
  <div class="content">
    <h2>문을 여세요</h2>
    <p class="lead">향, 차, 빵 그리고 빛. 오늘의 처방을 고르세요.</p>
  </div>
</section>

<!-- ===== 4) Tiles corridor — 6.png ===== -->
<section id="tiles" class="section">
  <img class="bg" data-file="6.png" alt="">
  <div class="content">
    <h2>전통과 오늘 사이</h2>
    <p class="lead">방식은 지키고 디테일은 업데이트했습니다.</p>
  </div>
  <div class="timeline" aria-hidden="true">
    <div class="tp"><div class="dot"></div><div>16세기 · Trastevere</div></div>
    <div class="tp"><div class="dot"></div><div>교황청 처방 기록</div></div>
    <div class="tp"><div class="dot"></div><div>2025 · 일상 의식</div></div>
  </div>
</section>

<!-- ===== 5) Products — 7.png ===== -->
<section id="products" class="section">
  <img class="bg" data-file="7.png" alt="">
  <div class="content"><h2>하루를 만드는 구성</h2><p class="lead">앰플, 허브티, 비스코티, 캔들</p></div>
  <div class="mag-row" aria-hidden="true"><div class="mag" data-mass="1.2"></div><div class="mag" data-mass="1.0"></div><div class="mag" data-mass="1.4"></div><div class="mag" data-mass="1.1"></div></div>
</section>

<!-- ===== 6) UGC — 8.png ===== -->
<section id="ugc" class="section">
  <img class="bg" data-file="8.png" alt="">
  <div class="content"><h2>진짜 식탁, 진짜 빛</h2><p class="lead">과장 없는 일상의 장면들.</p></div>
  <div class="grid" aria-hidden="true"><div class="cell"></div><div class="cell"></div><div class="cell"></div><div class="cell"></div></div>
</section>

<!-- ===== 7) Membership — 9.png ===== -->
<section id="member" class="section">
  <img class="bg" data-file="9.png" alt="">
  <div class="shine"></div>
  <div class="content"><h2>Scala Ritual Club</h2><p class="lead">초대·샘플·프리뷰. 쓰는 만큼 깊어지는 혜택.</p></div>
</section>

<!-- ===== 8) Gift — 10.png ===== -->
<section id="gift" class="section">
  <img class="bg" data-file="10.png" alt="">
  <div class="content"><h2>마음이 보이는 포장</h2><p class="lead">카드와 왁스 실링, 연중 가능.</p></div>
</section>

<!-- ===== 9) Membership BG / Warm — 11.png ===== -->
<section id="s11" class="section">
  <img class="bg" data-file="11.png" alt="">
  <div class="content"><h2>Atelier</h2><p class="lead">조용한 배경, 집중되는 시간.</p></div>
</section>

<!-- ===== 10) Amber Bottle — 12.png ===== -->
<section id="s12" class="section">
  <img class="bg" data-file="12.png" alt="">
  <div class="content"><h2>Handcrafted</h2><p class="lead">한 병의 이야기, 한 번의 터치.</p></div>
</section>

<!-- ===== 11) Ingredients — 13.png ===== -->
<section id="s13" class="section">
  <img class="bg" data-file="13.png" alt="">
  <div class="content"><h2>Herbal Origin</h2><p class="lead">라벤더 · 세이지 · 로즈마리.</p></div>
</section>

<!-- ===== 12) Tea (한 방울의 변화 실제 장면) — 14.png ===== -->
<section id="liquid" class="section">
  <img class="bg" data-file="14.png" alt="">
  <canvas id="ripples" aria-hidden="true"></canvas>
  <div class="content"><h2>한 방울의 변화</h2><p class="lead">표면이 잔잔히 흔들리면 마음도 가라앉습니다.</p></div>
</section>

<!-- ===== 13) Atelier — 15.png ===== -->
<section id="s15" class="section">
  <img class="bg" data-file="15.png" alt="">
  <div class="content"><h2>Apotheca Inside</h2><p class="lead">빛과 그림자가 머무는 공간.</p></div>
</section>

<!-- ===== 14) Texture — 16.png ===== -->
<section id="s16" class="section">
  <img class="bg" data-file="16.png" alt="">
  <div class="content"><h2>향의 구조</h2><p class="lead">탑 · 미들 · 베이스.</p></div>
</section>

<!-- ===== 15) Essentials — 17.png ===== -->
<section id="s17" class="section">
  <img class="bg" data-file="17.png" alt="">
  <div class="content"><h2>Essentials</h2><p class="lead">당신의 하루를 구성하는 모든 것.</p></div>
</section>

<!-- ===== 16) Finale — 18.png ===== -->
<section id="s18" class="section">
  <img class="bg" data-file="18.png" alt="">
  <div class="content"><h2>Light Finale</h2><p class="lead">불빛 속에 머무는 잔향.</p></div>
</section>

<footer class="section" style="background:#1b130d">
  <div class="content">
    <h2 style="font-family:'EB Garamond',serif">Apoteca Scala</h2>
    <p class="lead" style="color:#e7dbbf">© 2025 Roma · Santa Maria della Scala</p>
  </div>
</footer>

<!-- ===== POPUP ===== -->
<div id="popup" aria-hidden="true">
  <div class="pop-ov"></div>
  <div class="pop" role="dialog" aria-modal="true" aria-labelledby="pop-title">
    <button class="x" aria-label="닫기">×</button>
    <h3 id="pop-title">Apoteca Scala 사전 예약</h3>
    <p>가장 먼저 소식을 받아보세요.</p>
    <input id="email" type="email" placeholder="이메일 주소 입력" required>
    <button class="cta" id="submitEmail">등록하기</button>
  </div>
</div>

<script>
/* ---------- 경로 자동 감지 (./ 또는 ./images/) ---------- */
const pathCandidates=["","images/","./images/"];
function resolvePath(file,done){
  let i=0; const im=new Image();
  const next=()=>{ if(i>=pathCandidates.length){done(null);return;}
    const src=pathCandidates[i++]+file; im.onload=()=>done(src); im.onerror=next; im.src=src; };
  next();
}
function loadImages(cb){
  const imgs=[...document.querySelectorAll('img[data-file]')];
  let left=imgs.length; if(!left){cb();return;}
  imgs.forEach(el=>resolvePath(el.dataset.file,(src)=>{ el.src=src||el.dataset.file; if(--left===0) cb(); }));
}

/* ---------- 애니메이션 초기화 (이미지 로드 후) ---------- */
function init(){
  const topbar=document.querySelector('.topbar');
  addEventListener('scroll',()=>{topbar.classList.toggle('scrolled',scrollY>innerHeight*0.7)},{passive:true});

  gsap.registerPlugin(ScrollTrigger);

  // 모든 섹션 핀/스크럽 + 배경 살짝 확대
  gsap.utils.toArray('.section').forEach(sec=>{
    ScrollTrigger.create({trigger:sec,start:'top top',end:'bottom top',pin:true,scrub:true,anticipatePin:1,pinSpacing:false});
    const bg=sec.querySelector('.bg'); sec.classList.add('visible');
    if(bg) gsap.fromTo(bg,{scale:1.02},{scale:1.06,scrollTrigger:{trigger:sec,start:"top top",end:"bottom top",scrub:true}});
  });

  // HERO 1→2→3 크로스페이드
  gsap.to('#hero .img-a',{opacity:1,scale:1,ease:'none',scrollTrigger:{trigger:'#hero',start:'top top',end:'+=33%',scrub:true}});
  gsap.to('#hero .img-b',{opacity:1,scale:1,ease:'none',scrollTrigger:{trigger:'#hero',start:'top+=20% top',end:'+=33%',scrub:true}});
  gsap.to('#hero .img-c',{opacity:1,ease:'none',scrollTrigger:{trigger:'#hero',start:'top+=45% top',end:'+=33%',scrub:true}});

  // Herbarium 돋보기
  const loupe=document.querySelector('#herb .loupe');
  ScrollTrigger.create({trigger:'#herb',start:'top center',end:'bottom center',scrub:true,
    onEnter:()=>loupe.style.opacity=.9,onLeave:()=>loupe.style.opacity=0,onEnterBack:()=>loupe.style.opacity=.9,onLeaveBack:()=>loupe.style.opacity=0});
  ['pointermove','touchmove'].forEach(evt=>{
    addEventListener(evt,e=>{
      const rect=document.querySelector('#herb').getBoundingClientRect();
      const x=(e.touches?e.touches[0].clientX:e.clientX), y=(e.touches?e.touches[0].clientY:e.clientY);
      if(y>rect.top && y<rect.bottom){ loupe.style.transform=`translate(${x - loupe.offsetWidth/2}px, ${y - loupe.offsetHeight/2}px)`; }
    },{passive:true});
  });

  // Door split (5.png)
  gsap.to('#door .left',{scaleX:0,ease:'power2.out',scrollTrigger:{trigger:'#door',start:'top 60%',end:'bottom top',scrub:true}});
  gsap.to('#door .right',{scaleX:0,ease:'power2.out',scrollTrigger:{trigger:'#door',start:'top 60%',end:'bottom top',scrub:true}});

  // Timeline dots
  gsap.to('#tiles .tp',{opacity:1,y:0,stagger:.12,duration:.8,ease:'power2.out',scrollTrigger:{trigger:'#tiles',start:'top 65%',once:true}});
  ScrollTrigger.create({trigger:'#tiles',start:'top top+=64',end:'+=120%',pin:'.timeline',scrub:true,snap:1/2});

  // Products magnets
  const mags=[...document.querySelectorAll('#products .mag')];
  addEventListener('pointermove',e=>{
    mags.forEach(m=>{
      const r=m.getBoundingClientRect(), cx=r.left+r.width/2, cy=r.top+r.height/2;
      const dx=e.clientX-cx, dy=e.clientY-cy, d=Math.hypot(dx,dy);
      const f=Math.max(0,140-d)/140*(parseFloat(m.dataset.mass)||1);
      m.style.transform=`translate(${dx*0.04*f}px, ${-10-Math.abs(dy)*0.01*f}px)`;
    });
  });

  // UGC 그리드
  gsap.to('#ugc .cell',{opacity:1,y:0,stagger:.1,duration:.7,ease:'power2.out',scrollTrigger:{trigger:'#ugc',start:'top 70%',once:true}});
  ScrollTrigger.create({trigger:'#ugc',start:'top top',end:'+=120%',scrub:true,onUpdate:self=>{
    const g=document.querySelector('#ugc .grid'); const p=self.progress; const cols=p<.33?4:(p<.66?3:2); g.style.gridTemplateColumns=`repeat(${cols},1fr)`; }});

  // Membership shine
  gsap.to('#member .shine',{opacity:1,duration:1.2,ease:'sine.inOut',scrollTrigger:{trigger:'#member',start:'top 70%',once:true}});
  gsap.to('#member .shine',{backgroundPosition:'150% 50%',repeat:-1,yoyo:true,duration:6,ease:'sine.inOut'});

  // Liquid ripples (14.png)
  const cvs=document.getElementById('ripples'), ctx=cvs.getContext('2d');
  function fit(){cvs.width=innerWidth; cvs.height=document.getElementById('liquid').offsetHeight}
  addEventListener('resize',fit,{passive:true}); fit();
  let waves=[]; (function loop(){ctx.clearRect(0,0,cvs.width,cvs.height); waves=waves.filter(w=>w.a>0.02);
    for(const w of waves){w.r+=2.2; w.a*=0.985; ctx.beginPath(); ctx.arc(w.x,w.y,w.r,0,Math.PI*2); ctx.strokeStyle=`rgba(255,230,180,${w.a})`; ctx.lineWidth=1.5; ctx.stroke();}
    requestAnimationFrame(loop);} )();
  let t; addEventListener('scroll',()=>{clearTimeout(t);t=setTimeout(()=>{const r=document.getElementById('liquid').getBoundingClientRect();
    if(r.top<innerHeight && r.bottom>0){ waves.push({x:cvs.width*.5,y:cvs.height*.65,r:4,a:.9}); }},90)},{passive:true});

  // 입자(상시)
  const pc=document.getElementById('particles'),px=pc.getContext('2d'); function psize(){pc.width=innerWidth;pc.height=innerHeight}
  addEventListener('resize',psize,{passive:true}); psize();
  const pts=Array.from({length:160},()=>({x:Math.random()*pc.width,y:Math.random()*pc.height,v:.2+Math.random()*.5,r:.6+Math.random()*1.4}));
  (function pl(){px.clearRect(0,0,pc.width,pc.height); px.fillStyle='rgba(194,165,98,.7)';
    pts.forEach(p=>{p.y+=p.v; if(p.y>pc.height){p.y=-10;p.x=Math.random()*pc.width} px.beginPath(); px.arc(p.x,p.y,p.r,0,Math.PI*2); px.fill();});
    requestAnimationFrame(pl)})();

  // 팝업 (5초 후)
  const pop=document.getElementById('popup'); const show=()=>{pop.classList.add('active');pop.setAttribute('aria-hidden','false')};
  setTimeout(show,5000);
  document.querySelector('#popup .x').addEventListener('click',()=>{pop.classList.remove('active');pop.setAttribute('aria-hidden','true')});
  document.getElementById('submitEmail').addEventListener('click',()=>{
    const v=document.getElementById('email').value.trim();
    if(v){ alert('사전예약 등록 완료: '+v); pop.classList.remove('active'); }
  });
}

/* 시작: 이미지 로드 후 초기화 */
loadImages(init);
</script>
</body>
</html>
